<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>UIBezierPath</title>
    <meta name="description" content="Simplicity is the ultimate sophistication.
">

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="/ios/2015/01/01/UIBezierPath.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Jowyer's Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/contact/">Contact</a>
          
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">UIBezierPath</h1>
    <p class="post-meta">Jan 1, 2015</p>
  </header>

  <article class="post-content">
    <p>在<a href="http://jowyer.github.io/ios/2014/12/25/QR%20Code.html">上一篇文章</a>的demo中，用到了UIBezierPath绘图，正好想总结下其用法，于是就有了这一篇。</p>

<h2 id="introduction">Introduction</h2>
<p>A <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIBezierPath_class/index.html">UIBezierPath</a> object is a wrapper for a <code>CGPathRef</code> data type, which is the path-related features in the Core Graphics framework. </p>

<h3 id="path">Path</h3>
<p><strong>Paths</strong> are vector-based shapes that are built using line and curve segments. You can use line segments to create rectangles and polygons, and you can use curve segments to create arcs, circles, and complex curved shapes. Each segment consists of one or more points (in the current coordinate system) and a drawing command that defines how those points are interpreted.</p>

<h3 id="subpath">Subpath</h3>
<p>Each set of connected line and curve segments form what is referred to as a <strong>subpath</strong>. The end of one line or curve segment in a subpath defines the beginning of the next. A single UIBezierPath object may contain one or more subpaths that define the overall path, separated by <code>moveToPoint:</code> commands that effectively raise the drawing pen and move it to a new location.</p>

<h3 id="process">Process</h3>

<ol>
  <li>Create the path object.</li>
  <li>Set any relevant drawing attributes of your <code>UIBezierPath</code> object, such as the <code>lineWidth</code> or <code>lineJoinStyle</code> properties for stroked paths or the <code>usesEvenOddFillRule</code> property for filled paths. These drawing attributes apply to the entire path.</li>
  <li>Set the starting point of the initial segment using the <code>moveToPoint:</code> method.</li>
  <li>Add line and curve segments to define a subpath.</li>
  <li>Optionally, close the subpath by calling <code>closePath</code>, which draws a straight line segment from the end of the last segment to the beginning of the first.</li>
  <li>Optionally, repeat the steps 3, 4, and 5 to define additional subpaths.</li>
</ol>

<h2 id="cashapelayer">CAShapeLayer</h2>
<p>The <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAShapeLayer_class/">CAShapeLayer</a> class draws a cubic Bezier spline in its coordinate space. The shape is composited between the layer’s contents and its first sublayer.</p>

<h3 id="path-property">path property</h3>
<p><code>@property CGPathRef path</code><br />
The <code>path</code> defining the shape to be rendered. Animatable.</p>

<h2 id="usage">Usage</h2>

<h3 id="section">1. 头像框外的倒计时</h3>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="cp">#define   DEGREES_TO_RADIANS(degrees)  ((M_PI * degrees)/ 180)</span>

<span class="kt">float</span> <span class="n">shapeLayerWidth</span> <span class="o">=</span> <span class="mf">60.0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">shapeLayerHeight</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">arcFactor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">shapeLayerWidth</span> <span class="o">*</span> <span class="n">arcFactor</span><span class="p">;</span>
        
<span class="bp">UIBezierPath</span> <span class="o">*</span><span class="n">aPath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIBezierPath</span> <span class="n">bezierPath</span><span class="p">];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">moveToPoint</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">shapeLayerWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)];</span>

<span class="p">[</span><span class="n">aPath</span> <span class="nl">addLineToPoint</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">shapeLayerWidth</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">)];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">addArcWithCenter</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">shapeLayerWidth</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span> <span class="nl">radius</span><span class="p">:</span><span class="n">radius</span> <span class="nl">startAngle</span><span class="p">:</span><span class="n">DEGREES_TO_RADIANS</span><span class="p">(</span><span class="mi">270</span><span class="p">)</span> <span class="nl">endAngle</span><span class="p">:</span><span class="n">DEGREES_TO_RADIANS</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span> <span class="nl">clockwise</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">addLineToPoint</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">shapeLayerWidth</span><span class="p">,</span> <span class="n">radius</span><span class="p">)];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">addLineToPoint</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">shapeLayerWidth</span><span class="p">,</span> <span class="n">shapeLayerHeight</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">addArcWithCenter</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">shapeLayerWidth</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">shapeLayerHeight</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span> <span class="nl">radius</span><span class="p">:</span><span class="n">radius</span> <span class="nl">startAngle</span><span class="p">:</span><span class="n">DEGREES_TO_RADIANS</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="nl">endAngle</span><span class="p">:</span><span class="n">DEGREES_TO_RADIANS</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span> <span class="nl">clockwise</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">addLineToPoint</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">shapeLayerHeight</span><span class="p">)];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">addArcWithCenter</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">shapeLayerHeight</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span> <span class="nl">radius</span><span class="p">:</span><span class="n">radius</span> <span class="nl">startAngle</span><span class="p">:</span><span class="n">DEGREES_TO_RADIANS</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span> <span class="nl">endAngle</span><span class="p">:</span><span class="n">DEGREES_TO_RADIANS</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="nl">clockwise</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">addLineToPoint</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">)];</span>
<span class="p">[</span><span class="n">aPath</span> <span class="nl">addArcWithCenter</span><span class="p">:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span> <span class="nl">radius</span><span class="p">:</span><span class="n">radius</span> <span class="nl">startAngle</span><span class="p">:</span><span class="n">DEGREES_TO_RADIANS</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="nl">endAngle</span><span class="p">:</span><span class="n">DEGREES_TO_RADIANS</span><span class="p">(</span><span class="mi">270</span><span class="p">)</span> <span class="nl">clockwise</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>

<span class="p">[</span><span class="n">aPath</span> <span class="n">closePath</span><span class="p">];</span>
       
        
<span class="n">shapeLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAShapeLayer</span> <span class="n">new</span><span class="p">];</span>
<span class="n">shapeLayer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shapeLayerWidth</span><span class="p">,</span> <span class="n">shapeLayerHeight</span><span class="p">);</span>
<span class="n">shapeLayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">aPath</span><span class="p">.</span><span class="bp">CGPath</span><span class="p">;</span>
<span class="n">shapeLayer</span><span class="p">.</span><span class="n">strokeColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">greenColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
<span class="n">shapeLayer</span><span class="p">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">clearColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
<span class="n">shapeLayer</span><span class="p">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>     
<span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span> <span class="n">shapeLayer</span><span class="p">];</span></code></pre></div>

<p>动画部分：</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">playLoopAnimation</span>
<span class="p">{</span>
    <span class="n">uint</span> <span class="n">waitTime</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
    
    <span class="bp">CABasicAnimation</span> <span class="o">*</span><span class="n">pathAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CABasicAnimation</span> <span class="nl">animationWithKeyPath</span><span class="p">:</span> <span class="s">@&quot;strokeStart&quot;</span><span class="p">];</span>
    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">waitTime</span><span class="p">;</span>
    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">removedOnCompletion</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">fromValue</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithFloat</span><span class="p">:</span><span class="mf">0.1f</span><span class="p">];</span>
    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithFloat</span><span class="p">:</span><span class="mf">1.0f</span><span class="p">];</span>
    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">fillMode</span> <span class="o">=</span> <span class="n">kCAFillModeForwards</span><span class="p">;</span>
    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">timingFunction</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAMediaTimingFunction</span> <span class="nl">functionWithName</span><span class="p">:</span> <span class="n">kCAMediaTimingFunctionLinear</span><span class="p">];</span>
    <span class="p">[</span><span class="n">shapeLayer</span> <span class="nl">addAnimation</span><span class="p">:</span> <span class="n">pathAnimation</span> <span class="nl">forKey</span><span class="p">:</span> <span class="s">@&quot;PathAnim&quot;</span><span class="p">];</span>
            
    <span class="bp">CABasicAnimation</span> <span class="o">*</span><span class="n">shadeAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CABasicAnimation</span> <span class="nl">animationWithKeyPath</span><span class="p">:</span> <span class="s">@&quot;strokeColor&quot;</span><span class="p">];</span>
    <span class="n">shadeAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">waitTime</span> <span class="o">*</span> <span class="mf">0.6f</span><span class="p">;</span>
    <span class="n">shadeAnimation</span><span class="p">.</span><span class="n">removedOnCompletion</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="n">shadeAnimation</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="n">shadeAnimation</span><span class="p">.</span><span class="n">fromValue</span> <span class="o">=</span> <span class="p">(</span><span class="kt">id</span><span class="p">)[</span><span class="bp">UIColor</span> <span class="n">greenColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
    <span class="n">shadeAnimation</span><span class="p">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="p">(</span><span class="kt">id</span><span class="p">)[</span><span class="bp">UIColor</span> <span class="n">yellowColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
    <span class="n">shadeAnimation</span><span class="p">.</span><span class="n">fillMode</span> <span class="o">=</span> <span class="n">kCAFillModeForwards</span><span class="p">;</span>
    <span class="p">[</span><span class="n">shapeLayer</span> <span class="nl">addAnimation</span><span class="p">:</span> <span class="n">shadeAnimation</span> <span class="nl">forKey</span><span class="p">:</span> <span class="s">@&quot;ColorAnimGreenToYellow&quot;</span><span class="p">];</span>
<span class="p">}</span></code></pre></div>

<h3 id="qr-code">2. QR Code的外边框</h3>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="bp">AVMetadataMachineReadableCodeObject</span> <span class="o">*</span><span class="n">code</span><span class="p">;</span>
<span class="bp">UIBezierPath</span> <span class="o">*</span><span class="n">cornersBoxPath</span><span class="p">;</span>
<span class="bp">UIBezierPath</span> <span class="o">*</span><span class="n">boundingBoxPath</span><span class="p">;</span>

<span class="n">CGMutablePathRef</span> <span class="n">cornersPath</span> <span class="o">=</span> <span class="n">CGPathCreateMutable</span><span class="p">();</span>   
<span class="bp">CGPoint</span> <span class="n">point</span><span class="p">;</span>
<span class="n">CGPointMakeWithDictionaryRepresentation</span><span class="p">((</span><span class="n">CFDictionaryRef</span><span class="p">)</span><span class="n">code</span><span class="p">.</span><span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">point</span><span class="p">);</span>

<span class="n">CGPathMoveToPoint</span><span class="p">(</span><span class="n">cornersPath</span><span class="p">,</span> <span class="nb">nil</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">code</span><span class="p">.</span><span class="n">corners</span><span class="p">.</span><span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CGPointMakeWithDictionaryRepresentation</span><span class="p">((</span><span class="n">CFDictionaryRef</span><span class="p">)</span><span class="n">code</span><span class="p">.</span><span class="n">corners</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">point</span><span class="p">);</span>
    <span class="n">CGPathAddLineToPoint</span><span class="p">(</span><span class="n">cornersPath</span><span class="p">,</span> <span class="nb">nil</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
    
<span class="n">CGPathCloseSubpath</span><span class="p">(</span><span class="n">cornersPath</span><span class="p">);</span>
    
<span class="n">cornersBoxPath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIBezierPath</span> <span class="nl">bezierPathWithCGPath</span><span class="p">:</span><span class="n">cornersPath</span><span class="p">];</span>
<span class="n">CGPathRelease</span><span class="p">(</span><span class="n">cornersPath</span><span class="p">);</span>
    
<span class="n">boundingBoxPath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIBezierPath</span> <span class="nl">bezierPathWithRect</span><span class="p">:</span><span class="n">code</span><span class="p">.</span><span class="n">bounds</span><span class="p">];</span>


<span class="bp">CAShapeLayer</span> <span class="o">*</span><span class="n">boundingBoxLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAShapeLayer</span> <span class="n">new</span><span class="p">];</span>
<span class="n">boundingBoxLayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">boundingBoxPath</span><span class="p">.</span><span class="bp">CGPath</span><span class="p">;</span>
<span class="n">boundingBoxLayer</span><span class="p">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="mf">2.f</span><span class="p">;</span>
<span class="n">boundingBoxLayer</span><span class="p">.</span><span class="n">strokeColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">greenColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
<span class="n">boundingBoxLayer</span><span class="p">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">0.f</span> <span class="nl">green</span><span class="p">:</span><span class="mf">1.f</span> <span class="nl">blue</span><span class="p">:</span><span class="mf">0.f</span> <span class="nl">alpha</span><span class="p">:</span><span class="mf">.5f</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
<span class="p">[</span><span class="n">_previewView</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">boundingBoxLayer</span><span class="p">];</span>
            
<span class="bp">CAShapeLayer</span> <span class="o">*</span><span class="n">cornersBoxLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAShapeLayer</span> <span class="n">new</span><span class="p">];</span>
<span class="n">cornersBoxLayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">cornersBoxPath</span><span class="p">.</span><span class="bp">CGPath</span><span class="p">;</span>
<span class="n">cornersBoxLayer</span><span class="p">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="mf">2.f</span><span class="p">;</span>
<span class="n">cornersBoxLayerstrokeColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
<span class="n">cornersBoxLayer</span><span class="p">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">0.f</span> <span class="nl">green</span><span class="p">:</span><span class="mf">0.f</span> <span class="nl">blue</span><span class="p">:</span><span class="mf">1.f</span> <span class="nl">alpha</span><span class="p">:</span><span class="mf">.5f</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
<span class="p">[</span><span class="n">_previewView</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">cornersBoxLayer</span><span class="p">];</span></code></pre></div>

<h3 id="section-1">3. 含有中空部分的遮罩</h3>

<p>实现a：</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="bp">UIBezierPath</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIBezierPath</span> <span class="nl">bezierPathWithRect</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">scanView</span><span class="p">.</span><span class="n">frame</span><span class="p">];</span>
<span class="p">[</span><span class="n">path</span> <span class="nl">appendPath</span><span class="p">:[</span><span class="bp">UIBezierPath</span> <span class="nl">bezierPathWithRect</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">]];</span>
    
<span class="bp">CAShapeLayer</span> <span class="o">*</span><span class="n">maskLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAShapeLayer</span> <span class="n">new</span><span class="p">];</span>
<span class="n">maskLayer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
<span class="n">maskLayer</span><span class="p">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithWhite</span><span class="p">:</span><span class="mi">0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mf">.7</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
    
<span class="n">maskLayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="bp">CGPath</span><span class="p">;</span>
<span class="n">maskLayer</span><span class="p">.</span><span class="n">fillRule</span> <span class="o">=</span> <span class="n">kCAFillRuleEvenOdd</span><span class="p">;</span>
    
<span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">maskLayer</span><span class="p">];</span></code></pre></div>

<p>这里的<code>fillRule</code>有两种</p>

<ul>
  <li>
    <p>kCAFillRuleNonZero</p>

    <p>Specifies the <em>non-zero winding</em> rule. Count each left-to-right path as +1 and each right-to-left path as -1. If the sum of all crossings is 0, the point is outside the path. If the sum is nonzero, the point is inside the path and the region containing it is filled.<br />
默认的<code>fillRule</code>，如果计算值非零，则inside the path，绘制。</p>
  </li>
  <li>
    <p>kCAFillRuleEvenOdd</p>

    <p>Specifies the <em>even-odd winding</em> rule. Count the total number of path crossings. If the number of crossings is even, the point is outside the path. If the number of crossings is odd, the point is inside the path and the region containing it should be filled.<br />
如果计算值为奇数，则inside the path，绘制。</p>
  </li>
</ul>

<p><img src="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Art/eosampleone.gif" alt="" /></p>

<p>关于Fillling a Path，更详细的官方说明，可以看<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_paths/dq_paths.html#//apple_ref/doc/uid/TP30001066-CH211-TPXREF106">这里</a>。</p>

<p>实现b：</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="bp">UIBezierPath</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIBezierPath</span> <span class="nl">bezierPathWithRect</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">scanView</span><span class="p">.</span><span class="n">frame</span><span class="p">];</span>
<span class="p">[</span><span class="n">path</span> <span class="nl">appendPath</span><span class="p">:[</span><span class="bp">UIBezierPath</span> <span class="nl">bezierPathWithRect</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">]];</span>
    
<span class="bp">CAShapeLayer</span> <span class="o">*</span><span class="n">shapeLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAShapeLayer</span> <span class="n">new</span><span class="p">];</span>
<span class="n">shapeLayer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
<span class="n">shapeLayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="bp">CGPath</span><span class="p">;</span>
<span class="n">shapeLayer</span><span class="p">.</span><span class="n">fillRule</span> <span class="o">=</span> <span class="n">kCAFillRuleEvenOdd</span><span class="p">;</span>
    
<span class="bp">CALayer</span> <span class="o">*</span><span class="n">maskLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CALayer</span> <span class="n">new</span><span class="p">];</span>
<span class="n">maskLayer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
<span class="n">maskLayer</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">blackColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
<span class="n">maskLayer</span><span class="p">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
<span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">maskLayer</span><span class="p">];</span>
    
<span class="n">maskLayer</span><span class="p">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">shapeLayer</span><span class="p">;</span></code></pre></div>

<p>CALayer’s <code>mask</code> property:</p>

<p><code>@property(strong) CALayer *mask</code><br />
An optional layer whose alpha channel is used to mask the layer’s content.</p>

<p>如果实现了<code>mask</code>这个属性，则只有被<code>mask</code>的部分会被绘制。</p>

<h2 id="reference">Reference</h2>
<p><a href="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/BezierPaths/BezierPaths.html#//apple_ref/doc/uid/TP40010156-CH11-SW2">Apple Doc</a></p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Copyright © 2015 - Jowyer Wang</li> 
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Simplicity is the ultimate sophistication.
</p>
      </div>
    </div>

  </div>

</footer>

    <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("post")[0];  //  || document.getElementsByClassName("page")[0] 
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>


  </body>

</html>
